// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: verification.sql

package models

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const approveVerificationRequest = `-- name: ApproveVerificationRequest :exec
UPDATE verification_requests
SET
    status = 'approved',
    reviewed_by = (SELECT id FROM users WHERE uuid = $1),
    reviewed_at = CURRENT_TIMESTAMP,
    notes = $2
WHERE verification_requests.id = $3
`

type ApproveVerificationRequestParams struct {
	ReviewerUuid pgtype.Text
	Notes        pgtype.Text
	ID           int64
}

func (q *Queries) ApproveVerificationRequest(ctx context.Context, arg ApproveVerificationRequestParams) error {
	_, err := q.db.Exec(ctx, approveVerificationRequest, arg.ReviewerUuid, arg.Notes, arg.ID)
	return err
}

const createVerificationRequest = `-- name: CreateVerificationRequest :one
INSERT INTO verification_requests (
    user_id,
    integration_name,
    member_id,
    full_name,
    image_url,
    title,
    status
) VALUES (
    (SELECT id FROM users WHERE uuid = $1),
    $2,
    $3,
    $4,
    $5,
    $6,
    'pending'
) RETURNING id, user_id, integration_name, member_id, full_name, image_url, title, status, submitted_at, reviewed_by, reviewed_at, notes
`

type CreateVerificationRequestParams struct {
	UserUuid        pgtype.Text
	IntegrationName string
	MemberID        string
	FullName        string
	ImageUrl        string
	Title           pgtype.Text
}

func (q *Queries) CreateVerificationRequest(ctx context.Context, arg CreateVerificationRequestParams) (VerificationRequest, error) {
	row := q.db.QueryRow(ctx, createVerificationRequest,
		arg.UserUuid,
		arg.IntegrationName,
		arg.MemberID,
		arg.FullName,
		arg.ImageUrl,
		arg.Title,
	)
	var i VerificationRequest
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.IntegrationName,
		&i.MemberID,
		&i.FullName,
		&i.ImageUrl,
		&i.Title,
		&i.Status,
		&i.SubmittedAt,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.Notes,
	)
	return i, err
}

const deleteVerificationRequest = `-- name: DeleteVerificationRequest :exec
DELETE FROM verification_requests
WHERE verification_requests.id = $1
`

func (q *Queries) DeleteVerificationRequest(ctx context.Context, id int64) error {
	_, err := q.db.Exec(ctx, deleteVerificationRequest, id)
	return err
}

const getPendingVerifications = `-- name: GetPendingVerifications :many
SELECT vr.id, vr.user_id, vr.integration_name, vr.member_id, vr.full_name, vr.image_url, vr.title, vr.status, vr.submitted_at, vr.reviewed_by, vr.reviewed_at, vr.notes, u.username, u.uuid as user_uuid
FROM verification_requests vr
JOIN users u ON u.id = vr.user_id
WHERE vr.status = 'pending'
ORDER BY vr.submitted_at ASC
`

type GetPendingVerificationsRow struct {
	ID              int64
	UserID          int64
	IntegrationName string
	MemberID        string
	FullName        string
	ImageUrl        string
	Title           pgtype.Text
	Status          string
	SubmittedAt     pgtype.Timestamptz
	ReviewedBy      pgtype.Int8
	ReviewedAt      pgtype.Timestamptz
	Notes           pgtype.Text
	Username        pgtype.Text
	UserUuid        pgtype.Text
}

func (q *Queries) GetPendingVerifications(ctx context.Context) ([]GetPendingVerificationsRow, error) {
	rows, err := q.db.Query(ctx, getPendingVerifications)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetPendingVerificationsRow
	for rows.Next() {
		var i GetPendingVerificationsRow
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.IntegrationName,
			&i.MemberID,
			&i.FullName,
			&i.ImageUrl,
			&i.Title,
			&i.Status,
			&i.SubmittedAt,
			&i.ReviewedBy,
			&i.ReviewedAt,
			&i.Notes,
			&i.Username,
			&i.UserUuid,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getUserVerificationRequests = `-- name: GetUserVerificationRequests :many
SELECT vr.id, vr.user_id, vr.integration_name, vr.member_id, vr.full_name, vr.image_url, vr.title, vr.status, vr.submitted_at, vr.reviewed_by, vr.reviewed_at, vr.notes
FROM verification_requests vr
WHERE vr.user_id = (SELECT id FROM users WHERE uuid = $1)
ORDER BY vr.submitted_at DESC
`

func (q *Queries) GetUserVerificationRequests(ctx context.Context, userUuid pgtype.Text) ([]VerificationRequest, error) {
	rows, err := q.db.Query(ctx, getUserVerificationRequests, userUuid)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []VerificationRequest
	for rows.Next() {
		var i VerificationRequest
		if err := rows.Scan(
			&i.ID,
			&i.UserID,
			&i.IntegrationName,
			&i.MemberID,
			&i.FullName,
			&i.ImageUrl,
			&i.Title,
			&i.Status,
			&i.SubmittedAt,
			&i.ReviewedBy,
			&i.ReviewedAt,
			&i.Notes,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getVerificationRequest = `-- name: GetVerificationRequest :one
SELECT vr.id, vr.user_id, vr.integration_name, vr.member_id, vr.full_name, vr.image_url, vr.title, vr.status, vr.submitted_at, vr.reviewed_by, vr.reviewed_at, vr.notes, u.username, u.uuid as user_uuid
FROM verification_requests vr
JOIN users u ON u.id = vr.user_id
WHERE vr.id = $1
`

type GetVerificationRequestRow struct {
	ID              int64
	UserID          int64
	IntegrationName string
	MemberID        string
	FullName        string
	ImageUrl        string
	Title           pgtype.Text
	Status          string
	SubmittedAt     pgtype.Timestamptz
	ReviewedBy      pgtype.Int8
	ReviewedAt      pgtype.Timestamptz
	Notes           pgtype.Text
	Username        pgtype.Text
	UserUuid        pgtype.Text
}

func (q *Queries) GetVerificationRequest(ctx context.Context, id int64) (GetVerificationRequestRow, error) {
	row := q.db.QueryRow(ctx, getVerificationRequest, id)
	var i GetVerificationRequestRow
	err := row.Scan(
		&i.ID,
		&i.UserID,
		&i.IntegrationName,
		&i.MemberID,
		&i.FullName,
		&i.ImageUrl,
		&i.Title,
		&i.Status,
		&i.SubmittedAt,
		&i.ReviewedBy,
		&i.ReviewedAt,
		&i.Notes,
		&i.Username,
		&i.UserUuid,
	)
	return i, err
}

const hasPendingVerification = `-- name: HasPendingVerification :one
SELECT EXISTS(
    SELECT 1 FROM verification_requests
    WHERE user_id = (SELECT id FROM users WHERE uuid = $1)
    AND integration_name = $2
    AND status = 'pending'
) AS has_pending
`

type HasPendingVerificationParams struct {
	UserUuid        pgtype.Text
	IntegrationName string
}

func (q *Queries) HasPendingVerification(ctx context.Context, arg HasPendingVerificationParams) (bool, error) {
	row := q.db.QueryRow(ctx, hasPendingVerification, arg.UserUuid, arg.IntegrationName)
	var has_pending bool
	err := row.Scan(&has_pending)
	return has_pending, err
}

const rejectVerificationRequest = `-- name: RejectVerificationRequest :exec
UPDATE verification_requests
SET
    status = 'rejected',
    reviewed_by = (SELECT id FROM users WHERE uuid = $1),
    reviewed_at = CURRENT_TIMESTAMP,
    notes = $2
WHERE verification_requests.id = $3
`

type RejectVerificationRequestParams struct {
	ReviewerUuid pgtype.Text
	Notes        pgtype.Text
	ID           int64
}

func (q *Queries) RejectVerificationRequest(ctx context.Context, arg RejectVerificationRequestParams) error {
	_, err := q.db.Exec(ctx, rejectVerificationRequest, arg.ReviewerUuid, arg.Notes, arg.ID)
	return err
}
